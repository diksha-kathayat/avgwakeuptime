<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wakeup Time Result</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f4f7fa; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .custom-shadow { box-shadow: 0 10px 25px rgba(0, 0, 0, 0.03); }
    </style>
</head>
<body>
    <div class="bg-white p-8 rounded-2xl custom-shadow border border-slate-100 text-center min-w-[320px]">
        <p class="text-[10px] font-bold text-[#ef8e47] uppercase tracking-widest mb-2">Average Wakeup Time</p>
        <div class="flex items-center justify-center gap-4">
            <span id="wake-res" class="text-5xl font-extrabold text-slate-800 tracking-tighter">--:--</span>
            <button onclick="copyToClipboard('wake-res', this)" class="bg-slate-100 hover:bg-slate-200 px-3 py-2 rounded-lg text-slate-500 text-[11px] font-bold transition-all">
                <i class="fa-regular fa-copy"></i>
            </button>
        </div>
        <p class="text-[10px] text-slate-400 mt-2">Based on <span id="wake-cnt">0</span> days</p>
    </div>

    <script>
        function calcTime(data) {
            const entries = data.split(',').map(l => l.trim()).filter(l => /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(l));
            if (entries.length === 0) return;
            let sinSum = 0, cosSum = 0;
            entries.forEach(time => {
                const [h, m] = time.split(':').map(Number);
                const angle = ((h * 60 + m) / 1440) * 2 * Math.PI;
                sinSum += Math.sin(angle); cosSum += Math.cos(angle);
            });
            const avgAngle = Math.atan2(sinSum, cosSum);
            let avgMins = (avgAngle * 1440) / (2 * Math.PI);
            if (avgMins < 0) avgMins += 1440;
            const finalMins = Math.round(avgMins) % 1440;
            const h = Math.floor(finalMins / 60), m = finalMins % 60;
            document.getElementById('wake-res').innerText = String(h).padStart(2, '0') + ":" + String(m).padStart(2, '0');
            document.getElementById('wake-cnt').innerText = entries.length;
        }

        function copyToClipboard(id, btn) {
            const val = document.getElementById(id).innerText;
            if (val !== "--:--") {
                navigator.clipboard.writeText(val);
                btn.innerHTML = '<i class="fa-solid fa-check text-green-500"></i>';
                setTimeout(() => { btn.innerHTML = '<i class="fa-regular fa-copy"></i>'; }, 2000);
            }
        }

        const params = new URLSearchParams(window.location.search);
        if (params.has('wakeTimes')) calcTime(params.get('wakeTimes'));
    </script>
</body>
</html>